/*! slidle 2015-02-25 */

!function(a,b){"use strict";var c="prefix",d=["webkit","moz","ms"],e=(Array.prototype.slice.call(b).join("").match(new RegExp("-("+d.join("|")+")-"))||["",""])[1];a[c]=e}(this,this.getComputedStyle(document.documentElement)),function(a,b,c,d,e){"use strict";var f,g=a.prefix,h="Request",i="Full",j="moz"===g?"Screen":"screen",k="moz"===g?"Cancel":"Exit",l="Element",m="Enabled";f="requestFullscreen",d[f]===e&&(d[g+h+i+j]!==e?Object.defineProperty(d,f,{value:d[g+h+i+j]}):console.warn("No alternative for "+f)),f="exitFullscreen",c[f]===e&&(c[g+k+i+j]!==e?Object.defineProperty(c,f,{value:c[g+k+i+j]}):console.warn("No alternative for "+f)),f="fullscreenElement",b[f]===e&&(b[g+i+j+l]!==e?Object.defineProperty(b,f,{get:function(){return b[g+i+j+l]}}):console.warn("No alternative for "+f)),f="fullscreenEnabled",b[f]===e&&(b[g+i+j+m]!==e?Object.defineProperty(b,f,{get:function(){return b[g+i+j+m]}}):console.warn("No alternative for "+f))}(this,document,Document.prototype,Element.prototype),function(a,b,c){"use strict";function d(c,d,e){c.show.slides.splice(d,0,e);var f,g=b.createElement("DIV"),h=b.createElement("DIV"),i=e.text||"",j=e.align&&e.align.toLowerCase()||"left";"string"!=typeof i&&"number"==typeof i.length&&(i=i.join("\n")),g.className=D+" "+G,"left"===j?g.className+=" "+J:"center"===j?g.className+=" "+K:"right"===j?g.className+=" "+L:"justify"===j&&(g.className+=" "+M),c.frames.splice(d,0,g),d>=c.frames.length?c.canvas.appendChild(g):c.canvas.insertBefore(g,c.canvas.children[d]),h.className=H,h.innerHTML=a.markdown.toHTML(i),c.views.splice(d,0,h),g.appendChild(h),c.options.noedit||(h=b.createElement("DIV"),h.className=I,h.innerHTML=i,f=a.ace.edit(h),f.setTheme("ace/theme/"+c.options.editTheme),f.setPrintMarginColumn(!1),f.getSession().setMode("ace/mode/markdown"),f.getSession().setUseSoftTabs(!1),c.editors.splice(d,0,f),g.appendChild(h))}function e(b,c){return a.confirm("Are you sure you want to remove this slide?")?(b.show.slides.splice(c,1),b.canvas.removeChild(b.canvas.children[c]),b.frames.splice(c,1),b.views.splice(c,1),b.options.noedit||b.editors.splice(c,1),!0):!1}function f(b){a.clearTimeout(b.autoHideTimer),j(b.container,y),b.showingControl=!0,!b.inControl&&b.options.autoHideDelay>0&&(b.autoHideTimer=a.setTimeout(function(){i(b.container,y),b.showingControl=!1},b.options.autoHideDelay))}function g(b){a.clearTimeout(b.autoPlayTimer),b.autoPlayTimer=a.setTimeout(function(){b.isPlaying&&(b.index>=b.frames.length-1?b.options.loop?b.first():b.togglePlay():b.next())},b.options.autoPlayDelay)}function h(a,b,c,d){c=N[b].icon[c],d=N[b].icon[d],k(a.controlButtons[b],c,d)}function i(a,b){a.className=a.className+" "+b}function j(a,b){a.className=a.className.replace(" "+b,"")}function k(a,b,c){a.className=a.className.replace(" "+b," "+c)}function l(a,b,c){Object.keys(b).forEach(function(d){d.split(/\s+/).forEach(function(e){a.addEventListener(e,b[d],!!c)})})}function m(a){l(a,{mouseenter:function(){i(a,B)},mouseleave:function(){j(a,C),j(a,B)},mousedown:function(b){1===b.which&&i(a,C)},mouseup:function(b){1===b.which&&j(a,C)},touchstart:function(b){b.preventDefault(),B=" ",i(a,C)},touchend:function(b){b.preventDefault(),j(a,C)}})}var n="slidle",o="0.0.1",p={show:"json/welcome.json",showDelay:0,theme:"default",panel:!0,noedit:!1,editTheme:"solarized_light",nofull:!1,autoHideDelay:1618,autoPlayDelay:6180,loop:!1},q=n,r="theme",s="fullscreen",t="editing",u="canvas",v="panel",w="control",x="edit",y="hide",z="button",A="glyph",B="hover",C="active",D="frame",E="previous",F="current",G="next",H="viewer",I="editor",J="left",K="center",L="right",M="justify",N={toggleEdit:{icon:["chevron-up","chevron-down"],disabled:!1},first:{icon:"fast-backward",disabled:!0},previous:{icon:"step-backward",disabled:!0},togglePlay:{icon:["play","pause"],disabled:!1},next:{icon:"step-forward",disabled:!0},last:{icon:"fast-forward",disabled:!0},toggleFull:{icon:["resize-full","resize-small"],disabled:b.fullscreenEnabled!==!0}},O={insertSlide:{icon:"plus"},removeSlide:{icon:"remove"},alignLeft:{icon:"align-left"},alignCenter:{icon:"align-center"},alignRight:{icon:"align-right"},alignJustify:{icon:"align-justify"}},P={},Q=0,R=function(a,d){if("string"==typeof a&&(a=b.querySelector(a),!a))throw'Failed to select slidle container with "'+d.container+'"';return a.id||(a.id=n+ ++Q),P[a.id]===c?P[a.id]=new S.init(a,d):d!==c&&P[a.id].init(a,d),P[a.id]},S=R.prototype={constructor:R,options:p,container:c,canvas:c,panel:c,controlPanel:c,controlButtons:c,editPanel:c,editButtons:c,storage:c,show:c,frames:c,views:c,editors:c,index:-1,isEditing:!1,isPlaying:!1,autoHideTimer:c,inControl:!1,showingControl:!1,autoPlayTimer:c,init:function(c,g){var n=this;for(n.container=c,n.options=Object.create(S.options),Object.keys(g).forEach(function(a){n.options[a]=g[a]});c.lastChild;)c.removeChild(c.lastChild);return c.className+=" "+q+" "+r+"-"+n.options.theme,n.canvas=b.createElement("DIV"),n.canvas.className=u,c.appendChild(n.canvas),n.options.panel&&(n.panel=b.createElement("DIV"),n.panel.className=v,c.appendChild(n.panel),n.editPanel=b.createElement("DIV"),n.editPanel.className=x,n.panel.appendChild(n.editPanel),n.editButtons={},Object.keys(O).forEach(function(a){var c=n.editButtons[a]=b.createElement("BUTTON"),d=O[a].icon;"string"!=typeof d&&(d=d[0]),c.className=z+" "+A+" "+d,n.editPanel.appendChild(c),m(c)}),["Left","Center","Right","Justify"].forEach(function(a){var b=a.toLowerCase();l(n.editButtons["align"+a],{"mousedown touchstart":function(){j(n.frames[n.index],n.show.slides[n.index].align),n.show.slides[n.index].align=b,i(n.frames[n.index],b),n.saveShow()}})}),l(n.editButtons.insertSlide,{"mousedown touchstart":function(b){("mousedown"!==b.type||1===b.which)&&(i(n.editButtons.insertSlide,C),a.setTimeout(function(){j(n.editButtons.insertSlide,C)},382),d(n,n.index+1,{text:""}),n.moveTo(n.index+1),n.saveShow())}}),l(n.editButtons.removeSlide,{"mousedown touchstart":function(b){("mousedown"!==b.type||1===b.which)&&(i(n.editButtons.removeSlide,C),a.setTimeout(function(){j(n.editButtons.removeSlide,C)},382),e(n,n.index)&&(n.index>0?(n.index--,k(n.frames[n.index],E,F)):n.index<=n.frames.length-1&&k(n.frames[n.index],G,F),n.moveTo(n.index),n.saveShow()))}}),n.controlPanel=b.createElement("DIV"),n.controlPanel.className=w,n.panel.appendChild(n.controlPanel),n.controlButtons={},Object.keys(N).forEach(function(a){if(!("toggleFull"===a&&(n.options.nofull||N[a].disabled)||"toggleEdit"===a&&n.options.noedit)){var c=n.controlButtons[a]=b.createElement("BUTTON"),d=N[a].icon;"string"!=typeof d&&(d=d[0]),c.className=z+" "+A+" "+d,c.disabled=N[a].disabled,m(c),l(c,{mousedown:function(b){1===b.which&&S[a].call(n)},touchstart:function(){n.showingControl?S[a].call(n):f(n)},touchend:function(){n.showingControl||f(n)}}),n.controlPanel.appendChild(c)}})),n.isEditing=!1,n.isPlaying=!1,n.inControl=!1,n.showingControl=!0,n.storage=new a.slidle.storage,N.toggleFull.disabled||l(a,{resize:function(){var a=n.isFull()?0:1,b=1^a;j(n.container,s),0===a&&i(n.container,s),h(n,"toggleFull",a,b)}}),l(c,{"mousedown mousemove mouseup touchstart touchmove touchend":function(){f(n)}}),l(n.panel,{mouseenter:function(){n.inControl=!0,f(n)},mouseleave:function(){n.inControl=!1,f(n)}}),l(b,{keydown:function(a){var b=!0;switch(a.keyCode){case 32:n.togglePlay();break;case 34:case 35:n.last();break;case 33:case 36:n.first();break;case 37:case 38:n.previous();break;case 39:case 40:n.next();break;case 69:a.altKey&&!n.isEditing?n.toggleEdit():b=!1;break;case 70:a.altKey&&!n.isFull()?n.enterFull():b=!1;break;case 27:console.log("esc isediting? "+n.isEditing+" isFull "+n.isFull()),n.isFull()?n.exitFull():n.isEditing?n.toggleEdit():b=!1;break;default:b=!1}b&&a.preventDefault()}}),n.options.show&&a.setTimeout(function(){n.storage.fetch(n.options.show,n.setShow,n.failShow,n)},n.options.showDelay),n},setShow:function(a){var b=this;b.show={title:a.title,slides:[]},b.frames=[],b.views=[],b.editors=[],a.slides.forEach(function(a,c){d(b,c,a)}),b.moveTo(0),b.options.panel?f(b):b.togglePlay()},failShow:function(b,c,d){a.alert("Failed to fetch document from "+b+": "+c+" ("+d+")")},saveShow:function(){var b=this;b.frames.forEach(function(c,d){var e=b.editors[d].getValue();b.show.slides[d].text=e.split(/\r?\n/),b.views[d].innerHTML=a.markdown.toHTML(e)}),b.storage.write(b.show.title,b.show)},moveTo:function(a){var b=this;if(0===b.frames.length)return b.index=-1,["first","previous","togglePlay","next","last"].forEach(function(a){j(b.controlButtons[a],B),j(b.controlButtons[a],C),b.controlButtons[a].disabled=!0}),void["removeSlide","alignLeft","alignCenter","alignRight","alignJustify"].forEach(function(a){j(b.editButtons[a],B),j(b.editButtons[a],C),b.editButtons[a].disabled=!0});for(["removeSlide","alignLeft","alignCenter","alignRight","alignJustify"].forEach(function(a){b.editButtons[a].disabled=!1}),0>a?a=0:a>b.frames.length-1&&(a=b.frames.length-1);b.index<a;)b.index>=0&&k(b.frames[b.index],F,E),b.index++,k(b.frames[b.index],G,F);for(;b.index>a;)k(b.frames[b.index],F,G),b.index--,k(b.frames[b.index],E,F);0>=a?(j(b.controlButtons.first,B),j(b.controlButtons.first,C),b.controlButtons.first.disabled=!0,j(b.controlButtons.previous,B),j(b.controlButtons.previous,C),b.controlButtons.previous.disabled=!0):(b.controlButtons.first.disabled=!1,b.controlButtons.previous.disabled=!1),a>=b.frames.length-1?(j(b.controlButtons.next,B),j(b.controlButtons.next,C),b.controlButtons.next.disabled=!0,j(b.controlButtons.last,B),j(b.controlButtons.last,C),b.controlButtons.last.disabled=!0):(b.controlButtons.next.disabled=!1,b.controlButtons.last.disabled=!1),g(b)},first:function(){this.moveTo(0)},previous:function(){this.moveTo(this.index-1)},next:function(){this.moveTo(this.index+1)},last:function(){this.moveTo(this.frames.length-1)},toggleEdit:function(){var a=this,b=a.isEditing?1:0,c=1^b;a.options.noedit||(a.isEditing?(j(a.container,t),this.saveShow()):i(a.container,t),h(a,"toggleEdit",b,c),a.isEditing=!a.isEditing,a.isEditing?(a.isPlaying&&a.togglePlay(),j(a.controlButtons.togglePlay,C),j(a.controlButtons.togglePlay,B),a.controlButtons.togglePlay.disabled=!0):a.controlButtons.togglePlay.disabled=!1)},togglePlay:function(){var a=this,b=a.isPlaying?1:0,c=1^b;h(a,"togglePlay",b,c),a.isPlaying=!a.isPlaying,g(a)},toggleFull:function(){var a=this;a.options.nofull||(a.isFull()?a.exitFull():a.enterFull())},isFull:function(){var a=this;return!a.options.nofull&&a.container===b.fullscreenElement},enterFull:function(){var a=this;a.options.nofull||a.isFull()||a.container.requestFullscreen()},exitFull:function(){var a=this;!a.options.nofull&&a.isFull()&&b.exitFullscreen()}};S.init.prototype=S,R.version=o,a[n]=R}(this,document),function(a,b,c){function d(){return JSON.parse(b.getItem(g))}function e(a){return b.setItem(g,JSON.stringify(a))}function f(a){var b=d();b.last=a,e(b)}var g="slidle",h=g+".",i="untitled",j=0,k=function(){b.getItem(g)||b.setItem(g,JSON.stringify({list:[],last:""}))};k.prototype={constructor:k,list:function(){return d().list},last:function(){var a=d();return a.last?this.read(a.last):null},fetch:function(a,b,c,d,e){var f,g=this,h=g.read(a);return h?void b.call(d,h):(f=new XMLHttpRequest,f.onload=function(e){200===e.target.status?(h=JSON.parse(e.target.responseText),h.title=a,g.write(a,h),"function"==typeof b&&b.call(d,h)):"function"==typeof c&&c.call(d,a,e.target.status,e.target.statusText)},f.open("get",a,!e),void f.send())},read:function(a){f(a);var c=b.getItem(h+a);return c?JSON.parse(c):null},write:function(a,c){f(a),b.setItem(h+a,JSON.stringify(c))},create:function(a){if(a===c)a=i+"-"+ ++j;else if("string"!=typeof a||0===a.length)throw"Show title must be a non-empty string";if(null!==this.read(a))throw"Show titled '"+a+"' already exists";var b={slides:[]},f=d();return this.write(a,b),f.last=a,f.list.push(a),e(f),b},destroy:function(a){var b=d();b.list=b.list().filter(function(b){return b!==a}),b.last===a&&(b.last=b.list.length?b.list[b.list.length-1]:""),e(b)}},a.slidle.storage=k}(this,this.localStorage);
//# sourceMappingURL=slidle.min.js.map